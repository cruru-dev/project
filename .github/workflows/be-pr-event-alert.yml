name: BE/PM - PR Review Ïä¨Îûô ÏïåÎ¶º

on:
  pull_request:
    types: [review_requested]
    branches:
      - main
      - 'be/**'

  pull_request_review:
    types: [submitted]
    branches:
      - main
      - 'be/**'

env:
  Dobby-Kim: "U07BJABU6G1"
  U07BJABU6G1: "BEÌåÄ ÎèÑÎπÑ"
  Chocochip101: "U07BUEJDS8G"
  U07BUEJDS8G: "BEÌåÄ Ï¥àÏΩîÏπ©"
  xogns1514: "U07AZ26UC2J"
  U07AZ26UC2J: "BEÌåÄ Îü¨Ïâ¨"
  cutehumanS2: "U07B88ZQDU4"
  U07B88ZQDU4: "BEÌåÄ ÎÉ•Ïù∏"
  HyungHoKim00: "U07B5HBKZM1"
  U07B5HBKZM1: "BEÌåÄ Î™ÖÏò§"

jobs:
  review-requested_requested:
    if: github.event.action == 'review_requested'
    runs-on: ubuntu-latest
    steps:
      - name: Set reviewer and sender variables
        id: set-vars
        run: |
          echo "REVIEWER_SLACK_ID=${{ env[github.event.requested_reviewer.login] }}" >> $GITHUB_ENV
          echo "SENDER_SLACK_ID=${{ env[github.event.sender.login] }}" >> $GITHUB_ENV

      - name: pr reviewe ÏöîÏ≤≠ Ïãú slack ÏïåÎ¶º Î≥¥ÎÇ¥Í∏∞
        uses: slackapi/slack-github-action@v1.24.0
        with:
          channel-id: ${{ secrets.REVIEW_MENTION_CHANNEL_ID }}
          payload: |
            {
              "blocks": [
                {
                  "type": "divider"
                },
                {
                  "type": "header",
                  "text": {
                    "type": "plain_text",
                    "text": "‚ú® Î¶¨Î∑∞ ÏöîÏ≤≠ ‚ú®",
                    "emoji": true
                  }
                },
                {
                  "type": "context",
                  "elements": [
                    {
                      "type": "image",
                      "image_url": "${{ github.event.sender.avatar_url }}",
                      "alt_text": ""
                    },
                    {
                      "type": "plain_text",
                      "text": "<@${{ env.SENDER_SLACK_ID }}>",
                      "emoji": true
                    }
                  ]
                },
                {
                  "type": "section",
                  "fields": [
                    {
                      "type": "mrkdwn",
                      "text": "‚û°Ô∏è <@${{ env.REVIEWER_SLACK_ID }}>"
                    }
                  ]
                },
                {
                  "type": "section",
                  "fields": [
                    {
                      "type": "mrkdwn",
                      "text": "üí°*PR Ï†úÎ™©:*\n${{ github.event.pull_request.title }}"
                    }
                  ]
                },
                {
                  "type": "actions",
                  "elements": [
                    {
                      "type": "button",
                      "text": {
                        "type": "plain_text",
                        "text": "‚ö°Ô∏è PR Î∞îÎ°úÍ∞ÄÍ∏∞ ‚ö°Ô∏è",
                        "emoji": true
                      },
                      "value": "PR_LINK",
                      "url": "${{ github.event.pull_request.html_url }}",
                      "action_id": "actionId-1"
                    }
                  ]
                },
                {
                  "type": "divider"
                }
              ]
            }
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          
  review-submitted_alert:
    if: github.event.action == 'submitted' && github.event.review.state != 'APPROVED'
    runs-on: ubuntu-latest
    steps:
      - name: Set reviewer and reviewee variables
        id: set-vars
        run: |
          echo "REVIEWER_SLACK_ID=${{ env[github.event.sender.login] }}" >> $GITHUB_ENV
          echo "ASSIGNEE_SLACK_ID=${{ env[github.event.pull_request.login] }}" >> $GITHUB_ENV

      - name: pr Î¶¨Î∑∞ ÏôÑÎ£å ÌõÑ submitÎêòÎ©¥ revieweeÏóêÍ≤å slack ÏïåÎ¶º Î∞úÏÜ°
        if: env.ASSIGNEE_SLACK_ID != ''
        uses: slackapi/slack-github-action@v1.24.0
        with:
          channel-id: ${{ secrets.REVIEW_MENTION_CHANNEL_ID }}
          payload: |
            {
              "blocks": [
                {
                  "type": "divider"
                },
                {
                  "type": "header",
                  "text": {
                    "type": "plain_text",
                    "text": "üî•Î¶¨Î∑∞ ÏôÑÎ£åüî•",
                    "emoji": true
                  }
                },
                {
                  "type": "context",
                  "elements": [
                    {
                      "type": "image",
                      "image_url": "${{ github.event.sender.avatar_url }}",
                      "alt_text": ""
                    },
                    {
                      "type": "plain_text",
                      "text": "<@${{ env.REVIEWER_SLACK_ID }}>",
                      "emoji": true
                    }
                  ]
                },
                {
                  "type": "section",
                  "fields": [
                    {
                      "type": "mrkdwn",
                      "text": "‚û°Ô∏è <@${{ env.ASSIGNEE_SLACK_ID }}>"
                    }
                  ]
                },
                {
                  "type": "section",
                  "fields": [
                    {
                      "type": "mrkdwn",
                      "text": "üí°*PR Ï†úÎ™©:*\n${{ github.event.pull_request.title }}"
                    }
                  ]
                },
                {
                  "type": "actions",
                  "elements": [
                    {
                      "type": "button",
                      "text": {
                        "type": "plain_text",
                        "text": "‚öíÔ∏è Î∞õÏùÄ Î¶¨Î∑∞ ÌôïÏù∏ÌïòÍ∏∞ ‚öíÔ∏è",
                        "emoji": true
                      },
                      "value": "PR_LINK",
                      "url": "${{ github.event.pull_request.html_url }}",
                      "action_id": "actionId-1"
                    }
                  ]
                },
                {
                  "type": "divider"
                }
              ]
            }
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          
  pr-approved_alert:
    if: github.event.review.state == 'APPROVED'
    runs-on: ubuntu-latest
    steps:
      - name: Set assignee variables
        id: set-vars
        run: |
          echo "ASSIGNEE_SLACK_ID=${{ env[github.event.pull_request.assignee.login] }}" >> $GITHUB_ENV

      - name: pr reviewerÍ∞Ä Approve ÌïòÎ©¥ slack ÏïåÎ¶º Î≥¥ÎÉÑ
        uses: slackapi/slack-github-action@v1.24.0
        with:
          channel-id: ${{ secrets.TASK_COMPLETE_SLACK_CHANNEL_ID }}
          payload: |
            {
              "blocks": [
                {
                  "type": "divider"
                },
                {
                  "type": "header",
                  "text": {
                    "type": "plain_text",
                    "text": "üèÅ PR ÏäπÏù∏ üèÅ",
                    "emoji": true
                  }
                },
                {
                  "type": "section",
                  "fields": [
                    {
                      "type": "mrkdwn",
                      "text": "<@${{ env.ASSIGNEE_SLACK_ID }}>Îãò! Î¶¨Î∑∞Ïñ¥Îì§ÏóêÍ≤å ÏäπÏù∏ÏùÑ Î∞õÏïòÏñ¥Ïöî!"
                    }
                  ]
                },
                {
                  "type": "section",
                  "fields": [
                    {
                      "type": "mrkdwn",
                      "text": "üöÄ *PR Ï†úÎ™©:*\n${{ github.event.pull_request.title }}"
                    }
                  ]
                },
                {
                  "type": "actions",
                  "elements": [
                    {
                      "type": "button",
                      "text": {
                        "type": "plain_text",
                        "text": "üïπÔ∏è Merge ÌïòÎü¨ Í∞ÄÍ∏∞ üïπÔ∏è",
                        "emoji": true
                      },
                      "value": "PR_LINK",
                      "url": "http://www.d.c",
                      "action_id": "actionId-1"
                    }
                  ]
                },
                {
                  "type": "divider"
                }
              ]
            }
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
